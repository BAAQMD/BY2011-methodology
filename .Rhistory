cnty_abbr,
cnty_frac) %>%
spread(
cnty_abbr,
cnty_frac) %>%
tidyr::chop(
category) %>%
ensurer::ensure(
nrow(.) == 1) %>%
mutate(
category = "(all)") %>%
kable_BY2011_county_fractions()
BY2011_county_fraction_data %>%
filter_categories(
THESE_CATEGORIES) %>%
select(
category,
cnty_abbr,
cnty_frac) %>%
spread(
cnty_abbr,
cnty_frac) %>%
tidyr::chop(
category) %>%
ensurer::ensure(
nrow(.) == 1) %>%
mutate(
category = "(all)") %>%
gather(
cnty_abbr,
cnty_frac,
-category) %>%
kable_BY2011_county_fractions()
?kable
GHG2015_data <- read_csv("~/Dropbox/Projects/GHGs-2017-Q1/Patches/GHGs-patches-SAS-ODS_substitutes-v3.csv")
(BY2015_data <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 2))
(BY2015_data <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 3))
View (BY2015_data)
(BY2015_data <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 3) %>% filter(cat_h2 %>% str_detect("OZONE DEPLETING")))
BY2015_data
(BY2015_data <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 3) %>% filter(cat_h2 %>% str_detect("OZONE DEPLETING")) %>% select(cat_id, starts_with("cat_h")))
(GHG2015_data <- read_csv("~/Dropbox/Projects/GHGs-2017-Q1/Patches/GHGs-patches-SAS-ODS_substitutes-v3.csv"))
(GHG2015_data <- read_csv("~/Dropbox/Projects/GHGs-2017-Q1/Patches/GHGs-patches-SAS-ODS_substitutes-v3.csv") %>% distinct(cat_id, starts_with("cat_h")))
(GHG2015_data <- read_csv("~/Dropbox/Projects/GHGs-2017-Q1/Patches/GHGs-patches-SAS-ODS_substitutes-v3.csv") %>% select(cat_id, starts_with("cat_h")))
(GHG2015_data <- read_csv("~/Dropbox/Projects/GHGs-2017-Q1/Patches/GHGs-patches-SAS-ODS_substitutes-v3.csv") %>% select(cat_id, sector, activity, pol_abbr))
diff_and_render(BY2015_data, GHG2015_data)
View(GHG2015_data)
(GHG2015_data <- read_csv("~/Dropbox/Projects/GHGs-2017-Q1/Patches/GHGs-patches-SAS-ODS_substitutes-v3.csv") %>% select(cat_id, cat_h3 = sector, cat_h4 = activity, cat_h5 = pol_abbr))
1.01 ^ 20
THESE_CATEGORIES <- c(
"#108 Gravure" = 108,
"#109 Flexographic" = 109,
"#110 Letterpress" = 110,
"#112 Lithographic" = 112,
"#1898 Lithographic (Area)" = 1898,
"#115 Silkscreen" = 115,
"#1899 Silkscreen (Area)" = 1899,
"#116 Small Inhouse Print Services" = 116,
"#1900 Small Inhouse Print Services (Area)" = 1900)
#
# All of these categories are assigned the same growth profile, so let's just plot that.
#
growth_data <-
DB_raw_growth_profiles(
years = BY2011_YEARS,
nested = FALSE) %>%
filter(
gpf_id == 837)
source("chapter-setup.R")
##------ [welcome] Today is Thu Mar 12 12:39:14 2020 ------##
##------ [welcome] This is Ingres v2019.6.25 (2019-10-18 13:16:10) ------##
##------ [welcome] This is DataBank v2020.3.4 (2020-03-04 22:46:49) ------##
##------ [welcome] This is inventory v2020.2.6 (2020-02-06 22:28:25) ------##
#
# All of these categories are assigned the same growth profile, so let's just plot that.
#
growth_data <-
DB_raw_growth_profiles(
years = BY2011_YEARS,
nested = FALSE) %>%
filter(
gpf_id == 837)
growth_data %>%
chart_annual_growth_by(
color = cnty_abbr,
base_year = CY(2011),
year_limits = BY2011_YEAR_LIMITS,
year_expand = BY2011_YEAR_EXPAND,
title = "#837 Mdfd. Mfg-Prntg",
subtitle = "This profile is assigned to all BY2011 Printing categories.")
#
# All of these categories are assigned the same growth profile, so let's just plot that.
#
growth_data <-
DB_raw_growth_profiles(
years = BY2011_YEARS,
nested = FALSE) %>%
filter(
gpf_id == 262)
growth_data %>%
chart_BY2011_annual_growth_factors_by(
color = cnty_abbr,
title = "#262 Construction Growth",
subtitle = "This profile is assigned to all of BY2011 categories #1657 through #1675.")
#
# All of these categories are assigned the same growth profile, so let's just plot that.
#
growth_data <-
DB_raw_growth_profiles(
years = BY2011_YEARS,
nested = FALSE) %>%
filter(
gpf_id == 262)
growth_data %>%
chart_annual_growth_by(
color = cnty_abbr,
base_year = CY(2011),
flag_years = CY(2030),
year_limits = BY2011_YEAR_LIMITS,
year_expand = BY2011_YEAR_EXPAND,
title = "#262 Construction Growth",
subtitle = "This profile is assigned to all of BY2011 categories #1657 through #1675.")
#
# All of these categories are assigned the same growth profile, so let's just plot that.
#
growth_data <-
DB_raw_growth_profiles(
years = BY2011_YEARS,
nested = FALSE) %>%
filter(
gpf_id == 837)
growth_data %>%
chart_annual_growth_by(
color = cnty_abbr,
base_year = CY(2011),
year_limits = BY2011_YEAR_LIMITS,
year_expand = BY2011_YEAR_EXPAND,
flag_years = CY(2030),
title = "#837 Mdfd. Mfg-Prntg",
subtitle = "This profile is assigned to all BY2011 Printing categories.")
THESE_CATEGORIES <- c(
"#302 Gasoline" = 302,
"#303 Gas Fuel" = 303,
"#304 Liquid Fuel (Point)" = 304,
"#1578 Agricultural" = 1578)
BY2011_county_fraction_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_county_fractions()
BY2011_growth_profile_crosswalk %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_growth_crosswalk()
BY2011_annual_growth_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
chart_BY2011_annual_growth_factors_by(
color = cnty_abbr)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
chart_BY2011_annual_emissions_by(
fill = category)
RY(2009:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(305) %>% filter_pollutants("TOG") %>% pivot_table(rows = "fac_id")
P(12626) %>% with_facility_name()
PY(2009:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(305) %>% filter_pollutants("TOG") %>% pivot_table(rows = "fac_id")
PY(2007:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(305) %>% filter_pollutants("TOG") %>% pivot_table(rows = "fac_id")
RY(2007:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(305) %>% filter_pollutants("TOG") %>% pivot_table(rows = "fac_id")
RY(2007:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(301) %>% filter_pollutants("PM10") %>% pivot_table(rows = "fac_id")
RY(2007:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(301) %>% filter_pollutants("PM") %>% pivot_table(rows = "fac_id")
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(299, 305) %>% filter_pollutants("SO2") %>% pivot_table(rows = "fac_id")
PY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(299, 305) %>% filter_pollutants("SO2") %>% pivot_table(rows = "fac_id")
PY(1997:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(299, 305) %>% filter_pollutants("SO2") %>% pivot_table(rows = "fac_id")
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter_years(
CY(2008:2011)) %>%
filter_pollutants(
"TOG") %>%
convert_emission_units(
to = "ton/day") %>%
tabulate_emissions_by(
category,
pollutant,
year,
digits = 3) %>%
select(
Category = category,
starts_with("CY"),
Pollutant = pollutant,
Unit = ems_unit)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter_years(
CY(2008:2011)) %>%
filter_pollutants(
"TOG") %>%
convert_emission_units(
to = "ton/day") %>%
tabulate_emissions_by(
category,
pollutant,
year,
digits = 3) %>%
select(
Category = category,
starts_with("CY"),
Pollutant = pollutant,
Unit = ems_unit) %>%
kable_BY2011(
caption = "TOG emissions from inventoried pesticides (2011).")ss
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter_years(
CY(2008:2011)) %>%
filter_pollutants(
"TOG") %>%
convert_emission_units(
to = "ton/day") %>%
tabulate_emissions_by(
category,
pollutant,
year,
digits = 3) %>%
select(
Category = category,
starts_with("CY"),
Pollutant = pollutant,
Unit = ems_unit) %>%
kable_BY2011(
caption = "TOG emissions from inventoried pesticides (2011).")
THESE_CATEGORIES <- c(
"#1190 Agricultural, Methyl Bromide" = 1190,
"#1191 Agricultural, Other" = 1191,
"#1192 Non-Ag/Consumer, Methyl Bromide" = 1192,
"#1193 Non-Ag/Consumer, Other" = 1193)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter_years(
CY(2011)) %>%
filter_pollutants(
"TOG") %>%
convert_emission_units(
to = "ton/day") %>%
tabulate_emissions_by(
category,
pollutant,
year,
digits = 3) %>%
select(
Category = category,
starts_with("CY"),
Pollutant = pollutant,
Unit = ems_unit) %>%
kable_BY2011(
totals = "row",
caption = "TOG emissions from inventoried pesticides (2011).")
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter_years(
CY(2011)) %>%
filter_pollutants(
"TOG") %>%
convert_emission_units(
to = "ton/day") %>%
tabulate_emissions_by(
category,
pollutant,
year,
digits = 3) %>%
select(
category,
starts_with("CY"),
pollutant = pollutant,
unit = ems_unit) %>%
kable_BY2011(
totals = "row",
caption = "TOG emissions from inventoried pesticides (2011).")
BY2011_annual_emission_data %>% with_hierarchy(BY2011_category_hierarchy) %>% pivot_table(rows = "cat_id", inclusions = list(pol_abbr = list("NOx")))
BY2011_annual_emission_data %>% with_hierarchy(BY2011_category_hierarchy) %>% filter_pollutants("NOx") %>% pivot_table(rows = "cat_id")
BY2011_category_hierarchy %>% filter_categories(2190) %>% glimpse()
BY2011_annual_emission_data %>% with_hierarchy(BY2011_category_hierarchy) %>% filter_at(vars(starts_with("cat_h"), any_vars(str_detect(., "Container")))
)
BY2011_annual_emission_data %>% with_hierarchy(BY2011_category_hierarchy) %>% filter_at(vars(starts_with("cat_h")), any_vars(~ str_detect(., "Container")))
BY2011_annual_emission_data %>% with_hierarchy(BY2011_category_hierarchy) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container")))
BY2011_annual_emission_data %>% with_hierarchy(BY2011_category_hierarchy) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_id", "pol_abbr"))
BY2011_annual_emission_data %>% with_hierarchy(read_excel("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_h3", "cat_h4", "cat_h5", "cat_h6", "cat_id, "pol_abbr"))
BY2011_annual_emission_data %>% with_hierarchy(read_excel("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container")))
BY2011_annual_emission_data %>% with_hierarchy(read_csv("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container")))
BY2011_annual_emission_data %>% with_hierarchy(read_csv("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_h3", "cat_h4", "cat_h5", "cat_h6", "cat_id, "pol_abbr"))
BY2011_annual_emission_data %>% with_hierarchy(read_csv("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container")))
BY2011_annual_emission_data %>% with_hierarchy(read_csv("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_h3", "cat_h4", "cat_h5", "cat_h6", "cat_id, "pol_abbr"))
BY2011_annual_emission_data %>% with_hierarchy(read_csv("~/Dropbox/BY2015/Hierarchies/BY2015_default_category_hierarchy.csv")) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_h3", "cat_h4", "cat_h5", "cat_h6", "cat_id", "pol_abbr"))
BY2015_default_category_hierarchy <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 3) %>% select(cat_id, starts_with("cat_h")); BY2011_annual_emission_data %>% with_hierarchy(BY2015_default_category_hierarchy) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_h3", "cat_h4", "cat_h5", "cat_h6", "cat_id", "pol_abbr"))
BY2015_default_category_hierarchy <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 3) %>% select(cat_id, num_range("cat_h", 1:6)); BY2011_annual_emission_data %>% with_hierarchy(BY2015_default_category_hierarchy) %>% filter_at(vars(starts_with("cat_h")), any_vars(str_detect(., "Container"))) %>% pivot_table(rows = c("cat_h3", "cat_h4", "cat_h5", "cat_h6", "cat_id", "pol_abbr"))
BY2015_default_category_hierarchy <- read_excel("~/Dropbox/BY2015/Categories/BY2015_categories_assignment.xlsx", sheet = 3) %>% select(cat_id, num_range("cat_h", 1:6))
BY2015_default_category_hierarchy %>% filter_categories(2173, 2207)
BY2015_default_category_hierarchy %>% filter_categories(2173, 2207) %>% drop_vars(category)
BY2015_default_category_hierarchy %>% filter_categories(2173, 2207) %>% drop_vars(category) %>% copydat::Copy()
BY2015_default_category_hierarchy %>% filter_categories(2174, 2208) %>% drop_vars(category) %>% copydat::Copy()
RY(2007:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(301) %>% filter_pollutants("SO2") %>% pivot_table(rows = "fac_id")
RY(2007:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(299) %>% filter_pollutants("TOG") %>% pivot_table(rows = "fac_id")
tibble(src_code = "C1130235") %>% unpack_src_codes()
tibble(src_code = "C1130235") %>% unpack_src_codes() %>% glimpse()
DB_point_source_emission_factors() %>% filter(str_detect(src_code, "C1130235))
DB_point_source_emission_factors() %>% filter(str_detect(src_code, "C1130235"))
DB_point_source_emission_factors() %>% filter(str_detect(src_code, "C1130235"), pol_id == 990)
tibble(fac_id = 11, src_id = 1507, src_code = "C1130235") %>% unpack_src_codes() %>% inventory:::with_point_source_emission_factors()
tibble(fac_id = 11, src_id = 1507, src_code = "C1130235", pol_id = 990) %>% unpack_src_codes() %>% inventory:::with_point_source_emission_factors()
source("chapter-setup.R")
##------ [welcome] Today is Tue Mar 17 09:49:58 2020 ------##
##------ [welcome] This is Ingres v2019.6.25 (2019-10-18 13:16:10) ------##
##------ [welcome] This is DataBank v2020.3.4 (2020-03-04 22:46:49) ------##
##------ [welcome] This is inventory v2020.2.6 (2020-02-06 22:28:25) ------##
kable_data <-
tribble(
~ " ", "Agricultural Land", "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of constants for windblown dust calculations.")
kable_data <-
tribble(
~ " ", "Agricultural Land", "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data
kable_data <-
tribble(
~ " ", ~ "Agricultural Land", ~ "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of constants for windblown dust calculations.")
kable_data <-
tribble(
~ "Constant", ~ "Agricultural Land", ~ "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of constants for windblown dust calculations.") %>%
kableExtra::column_spec(
column = 1,
width = 20,
bold = TRUE)
kable_data <-
tribble(
~ " ", ~ "Agricultural Land", ~ "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of constants for windblown dust calculations.") %>%
kableExtra::column_spec(
column = 1,
width = 20,
bold = TRUE)
kable_data <-
tribble(
~ " ", ~ "Agricultural Land", ~ "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of constants for windblown dust calculations.") %>%
kableExtra::column_spec(
column = 1,
width = "20em",
bold = TRUE)
kable_data <-
tribble(
~ " ", ~ "Agricultural Land", ~ "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of constants for windblown dust calculations.") %>%
kableExtra::column_spec(
column = 1,
width = "6em",
bold = TRUE)
kable_data <-
tribble(
~ " ", ~ "Agricultural Land", ~ "Unpaved Roads",
"E", "0.025", ".038",
"I", "38 - 220", "86, 47, 56",
"C", "0.15", "0.15",
"K", "0.8, 0.6, 0.1, 0.6", "1.0",
"L", "0.74, 0.83, 0.77, 0.56", ".29 - .34",
"V", "0.05, 0.91, 0.26, 0.26", "1.0")
kable_data %>%
kable_BY2011(
align = "ccc",
caption = "Typical values of factors in windblown dust calculations.") %>%
kableExtra::column_spec(
column = 1,
width = "6em",
bold = TRUE)
BY2008::BY2008_annual_emission_data %>% filter_categories("P15")
BY2008::BY2008_annual_emission_data %>% filter_categories("P15") %>% pull_distinct(pol_abbr)
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM")
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% tabulate_emissions_by(cat_id, pol_abbr, year)
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% pivot_table(rows = c("cat_id"))
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% pivot_table(rows = c("cat_id"))
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% pivot_table(rows = c("cat_id", "fac_name"))
RY(2001:2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
RY(2001:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
RY(2001:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
RY(2001:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% convert_emission_units(to = "lb/yr") %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"), aggregator = "Sum over Sum", values = c("ems_qty", "tput_qty"))
RY(2001:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(13) %>% filter_pollutants("PM") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% convert_emission_units(to = "g/yr") %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"), aggregator = "Sum over Sum", values = c("ems_qty", "tput_qty"))
RY(2001:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(26) %>% filter_pollutants("PM") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
RY(2001:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(26) %>% filter_pollutants("CO") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
PY(1998:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(26) %>% filter_pollutants("CO") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
PY(1990:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(26) %>% filter_pollutants("CO") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
P(21) %>% with_facility_status()
P(21) %>% with_facility_address()
PY(1990:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_facilities(21)
PY(1990:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_facilities(foo = 21)
PY(1990:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_facilities(list(foo = 21))
PY(1990:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_facilities(list(foo = 21)) %>% pull_distinct(year)
DB_find_facility_ids(21)
PY(2000:2001) %>% DB_point_source_facilities()
PY(2000:2001) %>% DB_point_source_facilities() %>% filter(str_detect(fac_address, "6000 Bridge"))
PY(2000:2010) %>% DB_point_source_facilities() %>% filter(str_detect(fac_address, "6000 Bridge"))
RY(1990:2018) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(26) %>% filter_pollutants("CO") %>% with_facility_name() %>% with_source_name() %>% unpack_source_codes() %>% with_point_source_throughputs() %>% pivot_table(rows = c("cat_id", "fac_name", "src_id", "src_name", "src_code"))
source("chapter-setup.R")
##------ [welcome] Today is Mon Mar 23 07:11:44 2020 ------##
##------ [welcome] This is Ingres v2019.6.25 (2019-10-18 13:16:10) ------##
##------ [welcome] This is DataBank v2020.3.20 (2020-03-20 19:41:32) ------##
##------ [welcome] This is inventory v2020.2.6 (2020-02-06 22:28:25) ------##
THESE_CATEGORIES <- c(
"#10 Basic Processes" = 10,
"#11 Wastewater Collection & Separation" = 11,
"#12 Wastewater Treament Facilities" = 12,
"#13 Cooling Towers" = 13,
"#14 Vacuum Producing Systems" = 14,
"#15 Flares and Blowdown Systems" = 15,
"#16 Other Refining Processes" = 16)
RY(2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(THESE_CATEGORIES) %>% pivot_table(rows = c("cat_id"), columns = c("ems_unit", "year", "pol_abbr", "cnty_abbr"))
RY(2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(THESE_CATEGORIES) %>% pivot_table(rows = c("cnty_abbr"), columns = c("ems_unit", "year", "pol_abbr", "category"))
RY(2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(THESE_CATEGORIES) %>% pivot_table(rows = c("category"), columns = c("ems_unit", "year", "pol_abbr", "cnty_abbr"))
RY(2011) %>% DB_point_source_PONSCO_emissions() %>% filter_categories(THESE_CATEGORIES) %>% pivot_table(rows = c("category", "fac_id"), columns = c("ems_unit", "year", "pol_abbr", "cnty_abbr"))
library(BY2011)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr)
install("~/GitHub/BAAQMD/tbltools")
source("chapter-setup.R")
##------ [welcome] Today is Mon Mar 23 07:23:22 2020 ------##
##------ [welcome] This is Ingres v2019.6.25 (2019-10-18 13:16:10) ------##
##------ [welcome] This is DataBank v2020.3.20 (2020-03-20 19:41:32) ------##
##------ [welcome] This is inventory v2020.2.6 (2020-02-06 22:28:25) ------##
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr)
THESE_CATEGORIES <- c(
"#10 Basic Processes" = 10,
"#11 Wastewater Collection & Separation" = 11,
"#12 Wastewater Treament Facilities" = 12,
"#13 Cooling Towers" = 13,
"#14 Vacuum Producing Systems" = 14,
"#15 Flares and Blowdown Systems" = 15,
"#16 Other Refining Processes" = 16)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr) %>% divide_at(vars(CC, SOL), CC + SOL)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% split(.$pol_abbr) %>% map(tabulate_emissions_by, category, cnty_abbr))
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% split(.$pol_abbr) %>% map(tabulate_emissions_by, category, cnty_abbr)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% split(.$pol_abbr) %>% map(tabulate_emissions_by, category, cnty_abbr) %>% map(divide_at, vars(CC, SOL), CC + SOL)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% split(.$pol_abbr) %>% map(tabulate_emissions_by, category, cnty_abbr) %>% map(divide_at, vars(CC, SOL), CC + SOL) %>% map(mutate_at, vars(CC, SOL), format_percentage)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr) %>% divide_at(vars(CC, SOL), CC + SOL)
BY2011_annual_emission_data %>% filter_categories(14)
BY2011_annual_emission_data %>% filter_years(CY(2011)) %>% filter_categories(THESE_CATEGORIES) %>% tabulate_emissions_by(category, cnty_abbr) %>% divide_at(vars(CC, SOL), CC + SOL)
?pillar
