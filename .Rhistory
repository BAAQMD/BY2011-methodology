ship_type) %>%
tidyr::chop(
cat_id) %>%
{ set_names(
pull(., cat_id),
glue::glue(
"{pull(., ship_type)}, {pull(., ship_activity)}")) }
SHIP_CATEGORIES_BY_TYPE
CONTAINER_SHIP_CATEGORIES_BY_ACTIVITY
#
# Consolidated by type of ship (rather than type of activity or engine).
#
make_ship_categories_by_type <- function (type) {
ship_hierarchy %>%
filter(
ship_type %>% str_detect(type)) %>%
select(
ship_type,
ship_activity,
cat_id)  %>%
group_by(
ship_type) %>%
tidyr::chop(
cat_id) %>%
{ set_names(
pull(., cat_id),
glue::glue(
"{pull(., ship_type)}, {pull(., ship_activity)}")) }
}
CONTAINER_SHIP_CATEGORIES_BY_ACTIVITY <-
make_ship_categories_by_type("Container")
TANKER_SHIP_CATEGORIES_BY_ACTIVITY <-
make_ship_categories_by_type("Tanker")
#
# Consolidated by type of ship (rather than type of activity or engine).
#
make_ship_categories_by_type <- function (type) {
ship_hierarchy %>%
filter(
ship_type %>% str_detect(type)) %>%
select(
ship_type,
ship_activity,
cat_id)  %>%
group_by(
ship_type) %>%
tidyr::chop(
cat_id) %>%
{ set_names(
pull(., cat_id),
glue::glue(
"{pull(., ship_type)}, {pull(., ship_activity)}")) }
}
CONTAINER_SHIP_CATEGORIES <-
make_ship_categories_by_type("Container")
TANKER_SHIP_CATEGORIES <-
make_ship_categories_by_type("Tanker")
THESE_CATEGORIES
ship_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
2041:2220) %>%
select(
cat_h3,
cat_h4,
cat_id) %>%
mutate_at(
vars(cat_h3, cat_h4),
~ str_trim(str_remove_all(., "Ship(s?)"))) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.)) %>%
rename(
ship_activity = cat_h3)
THESE_CATEGORIES <-
ship_hierarchy %>%
transmute(
category = as.character(glue::glue(
"#{cat_id} {ship_type}, {ship_activity} ({eng_type})")),
cat_id) %>%
deframe()
THESE_CATEGORIES
SHIP_CATEGORIES_BY_TYPE
BY2011_annual_emission_data %>%
# filter_categories(
#   SHIP_CATEGORIES_BY_TYPE) %>%
filter_categories(
THESE_CATEGORIES) %>%
mutate(
category = case_when(
str_detect(category, "Container") ~ "Container",
str_detect(category, "Tanker") ~ "Tanker",
TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
SHIP_CATEGORIES_BY_TYPE) %>%
# filter_categories(
#   THESE_CATEGORIES) %>%
# mutate(
#   category = case_when(
#     str_detect(category, "Container") ~ "Container",
#     str_detect(category, "Tanker") ~ "Tanker",
#     TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
mutate(
category = case_when(
str_detect(category, "Container") ~ "Container",
str_detect(category, "Tanker") ~ "Tanker",
str_detect(category, "Passenger") ~ "Passenger",
TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
mutate(
category = case_when(
str_detect(., "Container") ~ "Container",
str_detect(category, "Tanker") ~ "Tanker",
str_detect(category, "Passenger") ~ "Passenger",
TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
THESE_CATEGORIES
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter(
str_detect(category, "Container")) %>%
mutate(
category = case_when(
str_detect(category, "Transit") ~ "Container Ships, In Transit",
str_detect(category, "Maneuver") ~ "Container Ships, Maneuvering",
TRUE ~ "Container Ships, Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter(
str_detect(category, "Container")) %>%
mutate(
category = case_when(
str_detect(category, "Transit") ~ "Container Ships, In Transit",
str_detect(category, "Maneuver") ~ "Container Ships, Maneuvering",
TRUE ~ "Container Ships, Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
filter(
str_detect(category, "Tanker")) %>%
mutate(
category = case_when(
str_detect(category, "Transit") ~ "Tankers, In Transit",
str_detect(category, "Maneuver") ~ "Tankers, Maneuvering",
TRUE ~ "Tankers, Other Activity")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
mutate(
category = case_when(
str_detect(category, "Container") ~ "Container",
str_detect(category, "Tanker") ~ "Tanker",
str_detect(category, "Passenger") ~ "Passenger",
TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
mutate(
category = case_when(
str_detect(category, "Aux") ~ "Auxiliary Engine",
str_detect(category, "Boiler") ~ "Boiler",
TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
THESE_CATEGORIES
BY2011_annual_emission_data %>%
filter_categories(
THESE_CATEGORIES) %>%
mutate(
category = case_when(
str_detect(category, "Aux") ~ "Auxiliary Engine",
str_detect(category, "Main") ~ "Main Engine",
str_detect(category, "Boiler") ~ "Boiler",
TRUE ~ "Other")) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_category_hierarchy %>% filter_categories(1769-1786)
BY2011_category_hierarchy %>% filter_categories(1769"1786)
BY2011_category_hierarchy %>% filter_categories(1769:1786)
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
CHC_hierarchy
?separate
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ",
missing = "") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ",
missing = "") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ",
missing = "") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ",
fill = "") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ",
fill = "right") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
THESE_CATEGORIES <-
CHC_hierarchy %>%
transmute(
category = as.character(glue::glue(
"#{cat_id} {ship_type} ({eng_type})")),
cat_id) %>%
deframe()
CHC_hierarchy <-
BY2011_category_hierarchy %>%
filter_categories(
1769:1786) %>%
select(
cat_h4,
cat_id) %>%
separate(
cat_h4,
into = c("ship_type", "eng_type"),
sep = " - ",
fill = "right") %>%
mutate_at(
vars(ship_type, eng_type),
~ str_trim(.))
CHC_hierarchy
THESE_CATEGORIES
deparse::deparse(THESE_CATEGORIES)
deparse::deparsec(THESE_CATEGORIES)
THESE_CATEGORIES <- list(
"#1769 Crew & Supply (Aux)" = 1769,
"#1770 Crew & Supply (Main)" = 1770,
"#1771 Excursion Ves. (Aux)" = 1771,
"#1772 Excursion Ves. (Main)" = 1772,
"#1773 Fishing Ves. Charter (Aux)" = 1773,
"#1774 Fishing Ves. Charter (Main)" = 1774,
"#1775 Fishing Ves. Com. (Aux)" = 1775,
"#1776 Fishing Ves. Com. (Main)" = 1776,
"#1777 Other Ves. (Aux)" = 1777,
"#1778 Other Ves. (Main)" = 1778,
"#1779 Pilot Ves. (Aux)" = 1779,
"#1780 Pilot Ves. (Main)" = 1780,
"#1781 Tow Boat (Aux)" = 1781,
"#1782 Tow Boat (Main)" = 1782,
"#1783 Tug Boat (Aux)" = 1783,
"#1784 Tug Boat (Main)" = 1784,
"#1785 Work Boat (Aux)" = 1785,
"#1786 Work Boat (Main)" = 1786)
THESE_CATEGORIES <- list(
"#1769 Crew & Supply (Aux)" = 1769,
"#1770 Crew & Supply (Main)" = 1770,
"#1771 Excursion Ves. (Aux)" = 1771,
"#1772 Excursion Ves. (Main)" = 1772,
"#1773 Fishing Ves. Charter (Aux)" = 1773,
"#1774 Fishing Ves. Charter (Main)" = 1774,
"#1775 Fishing Ves. Com. (Aux)" = 1775,
"#1776 Fishing Ves. Com. (Main)" = 1776,
"#1777 Other Ves. (Aux)" = 1777,
"#1778 Other Ves. (Main)" = 1778,
"#1779 Pilot Ves. (Aux)" = 1779,
"#1780 Pilot Ves. (Main)" = 1780,
"#1781 Tow Boat (Aux)" = 1781,
"#1782 Tow Boat (Main)" = 1782,
"#1783 Tug Boat (Aux)" = 1783,
"#1784 Tug Boat (Main)" = 1784,
"#1785 Work Boat (Aux)" = 1785,
"#1786 Work Boat (Main)" = 1786)
CONSOLIDATED_CATEGORIES <- list(
"#1769 Crew & Supply" = c(1769:1770),
"#1771 Excursion Ves." = c(1771:1772),
"#1773 Fishing Ves. Charter" = c(1773:1774),
"#1775 Fishing Ves. Com." = c(1775:1776),
"#1777 Other Ves." = c(1777:1778),
"#1779 Pilot Ves." = c(1779:1780),
"#1781 Tow Boat" = c(1781:1782),
"#1783 Tug Boat" = c(1783:1784),
"#1785 Work Boat" = c(1785:1786))
BY2011_annual_emission_data %>%
filter_categories(
CONSOLIDATED_CATEGORIES) %>%
chart_BY2011_annual_emissions_by(
fill = category)
THESE_CATEGORIES <- list(
"#1769 Crew & Supply (Aux)" = 1769,
"#1770 Crew & Supply (Main)" = 1770,
"#1771 Excursion Ves. (Aux)" = 1771,
"#1772 Excursion Ves. (Main)" = 1772,
"#1773 Fishing Ves. Charter (Aux)" = 1773,
"#1774 Fishing Ves. Charter (Main)" = 1774,
"#1775 Fishing Ves. Com. (Aux)" = 1775,
"#1776 Fishing Ves. Com. (Main)" = 1776,
"#1777 Other Ves. (Aux)" = 1777,
"#1778 Other Ves. (Main)" = 1778,
"#1779 Pilot Ves. (Aux)" = 1779,
"#1780 Pilot Ves. (Main)" = 1780,
"#1781 Tow Boat (Aux)" = 1781,
"#1782 Tow Boat (Main)" = 1782,
"#1783 Tug Boat (Aux)" = 1783,
"#1784 Tug Boat (Main)" = 1784,
"#1785 Work Boat (Aux)" = 1785,
"#1786 Work Boat (Main)" = 1786)
CONSOLIDATED_CATEGORIES <- list(
"#1769-1770 Crew & Supply" = c(1769:1770),
"#1771-1772 Excursion Ves." = c(1771:1772),
"#1773-1774 Fishing Ves. Charter" = c(1773:1774),
"#1775-1776 Fishing Ves. Com." = c(1775:1776),
"#1777-1778 Other Ves." = c(1777:1778),
"#1779-1780 Pilot Ves." = c(1779:1780),
"#1781-1782 Tow Boat" = c(1781:1782),
"#1783-1784 Tug Boat" = c(1783:1784),
"#1785-1786 Work Boat" = c(1785:1786))
BY2011_annual_emission_data %>%
filter_categories(
CONSOLIDATED_CATEGORIES) %>%
chart_BY2011_annual_emissions_by(
fill = category)
BY2011_annual_emission_data %>%
filter_categories(
CONSOLIDATED_CATEGORIES) %>%
chart_BY2011_annual_emissions_by(
color = category)
THESE_CATEGORIES <- c(
"#314 Incineration (Point)" = 314,
"#1579 Incineration (Area)" = 1579)
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_emission_factors(
pollutants = BY2011_POLLUTANTS,
digits = 2,
caption = "Emission factors (lb/ton).")
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
select(
category = cat_id,
pol_abbr,
ef_qty) %>%
distinct() %>%
spread(
pol_abbr,
ef_qty)
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_emission_factors(
pollutants = union(
BY2011_POLLUTANTS,
c("CO2_bio")),
digits = 2,
caption = "Emission factors (lb/ton).")
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_emission_factors(
pollutants = union(
BY2011_POLLUTANTS,
c("CO2_bio")),
digits = 3,
caption = "Emission factors (lb/ton).")
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_emission_factors(
pollutants = union(
BY2011_POLLUTANTS,
c("CO2_bio", "CH4", "N2O")),
caption = "Composite emission factors (lb/acre).")
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_emission_factors(
pollutants = union(
BY2011_POLLUTANTS,
c("CO2_bio", "CH4", "N2O")),
caption = "Composite emission factors (lb/fire).")
BY2011_annual_area_source_emission_factor_data %>%
filter_categories(
THESE_CATEGORIES) %>%
kable_BY2011_emission_factors(
pollutants = union(
BY2011_POLLUTANTS,
c("CO2", "CH4", "N2O")),
caption = "Emission factors (lb/MMcf).")
BY2011_annual_emission_data %>% filter_categories(2223) %>% filter_pollutants("TSP", "PM10", "PM2.5") %>% tabulate_emissions_by(cat_id, pol_abbr, year)
BY(2011) %>% DB_raw_growth_profiles(nested = FALSE) %>% filter(gpf_id == 898)
BY2011_annual_emission_data %>% filter_categories(1748) %>% filter_pollutants("TSP", "PM10", "PM2.5") %>% tabulate_emissions_by(cat_id, pol_abbr, year)
BY2011_annual_emission_data %>% filter_categories(42) %>% filter_pollutants("PM10")
BY2011_annual_emission_data %>% filter_categories(42) %>% filter_pollutants("PM10") %>% filter_years(CY(2011))
BY2011_annual_emission_data %>% filter_categories(42) %>% filter_pollutants("PM10") %>% filter_years(CY(2011)) %>% pull_total(ems_qty)
BY2011_annual_emission_data %>% filter_categories(42) %>% filter_pollutants("PM10") %>% filter_years(CY(2011)) %>% convert_emission_units(to = "ton/day") %>% pull_total(ems_qty)
BY2011_annual_emission_data %>% filter_categories(42) %>% filter_pollutants("TSP") %>% filter_years(CY(2011)) %>% convert_emission_units(to = "ton/day") %>% pull_total(ems_qty)
FROG11_data <- read_csv(
"~/Dropbox/BY2015/Work/Speciation/TOG/FROG11BY11.csv")
FROG15_data <- read_csv(
"~/Dropbox/BY2015/Work/Speciation/TOG/FROG15BY15.csv")
diff_and_render(
FROG11_data,
FROG15_data)
FROG15_data
FROG15_data %>% distinct(ROG)
FROG15_data %>% count(ROG)
FROG15_data %>% count(ROG, sort = TRUE)
FROG15_data %>% filter(cat_id %in% BY2011_sets$`Area sources`) %>% count(ROG, sort = TRUE)
webfraction_data <- read_xlsx(
"~/Dropbox/BY2015/Work/Speciation/References/ARB_Speciation/webfraction21nov19.xlsx",
sheet = "fraction_112119")
format_SIC("86090111004045")
strtools::format_SIC("86090111004045")
library(inventory)
strtools::format_EIC("86090111004045")
SIP2016::SIP2016_EIC_hierarchy %>% filter(EIC_id == strtools::format_EIC("86090111004045"))
t0324
t0325 %>% filter(p == 39)
t0325 %>% filter(p == 39) %>% glimpse()
?t0325
?t1325
t1325 %>% filter(p == 39) %>% glimpse()
